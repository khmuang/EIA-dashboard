<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EIA System Audit Dashboard - Central Group</title>
    <!-- React and Babel from CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Chart.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Modern UI Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #c41e3a; /* Central Red */
            --bg-body: #f4f7f6;
            --card-bg: #ffffff;
            --text-main: #2d3436;
            --text-secondary: #636e72;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #d63031;
            --border: #dfe6e9;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'IBM Plex Sans Thai', 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .header {
            background-color: var(--primary);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .header h1 { margin: 0; font-size: 1.5rem; font-weight: 700; }
        .header .date { font-size: 0.9rem; opacity: 0.9; }

        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        .section-title {
            margin: 2rem 0 1rem 0;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
            border-left: 5px solid var(--primary);
            padding-left: 1rem;
        }

        .kpi-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--primary);
        }

        .kpi-card h3 { margin: 0; font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
        .kpi-card .value { font-size: 2rem; font-weight: 700; margin: 0.5rem 0; color: var(--text-main); }
        .kpi-card.success { border-left-color: var(--success); }
        .kpi-card.warning { border-left-color: var(--warning); }
        .kpi-card.danger { border-left-color: var(--danger); }
        .kpi-card.info { border-left-color: #0984e3; }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            height: 380px;
            display: flex;
            flex-direction: column;
        }

        .chart-card h2 { margin: 0 0 1rem 0; font-size: 1.1rem; font-weight: 600; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; }
        .chart-container { flex-grow: 1; position: relative; }

        .full-width { grid-column: 1 / -1; height: auto; }

        .table-container {
            overflow-x: auto;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th { text-align: left; padding: 12px; border-bottom: 2px solid var(--border); color: var(--text-secondary); font-size: 0.85rem; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid var(--border); font-size: 0.95rem; }
        tr:hover { background-color: #f9fbfb; }

        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        .badge-danger { background-color: #fee2e2; color: #991b1b; }
        .badge-warning { background-color: #fef3c7; color: #92400e; }
        .badge-success { background-color: #d1fae5; color: #065f46; }

        @media (max-width: 768px) {
            .chart-grid { grid-template-columns: 1fr; }
            .kpi-row { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Data from dashboard_data.json
        const EMBEDDED_DATA = {
            "typeDistribution": [
                { "Name": "laptop", "Count": 5980 },
                { "Name": "desktop", "Count": 10694 },
                { "Name": "other", "Count": 189 },
                { "Name": "tablet", "Count": 87 },
                { "Name": "server", "Count": 1 }
            ],
            "total": 16951,
            "osDistribution": [
                { "Name": "Microsoft Windows 11 Pro x64", "Count": 9781 },
                { "Name": "Microsoft Windows 10 Pro x64", "Count": 3026 },
                { "Name": "Microsoft Windows 10 Enterprise LTSC x64", "Count": 2239 },
                { "Name": "Microsoft Windows Embedded 7 Standard", "Count": 597 },
                { "Name": "Microsoft Windows 10 Pro", "Count": 442 },
                { "Name": "Microsoft Windows 7 Professional", "Count": 363 }
            ],
            "bitlocker": { "on": 726, "off": 16225 },
            "buRisk": [
                { "Name": "CDG", "Count": 4740, "EOS": 2320 },
                { "Name": "CFR", "Count": 3495, "EOS": 2308 },
                { "Name": "CMG", "Count": 2009, "EOS": 1844 },
                { "Name": "PWB", "Count": 1314, "EOS": 1042 },
                { "Name": "SSP", "Count": 690, "EOS": 487 },
                { "Name": "B2S", "Count": 668, "EOS": 432 },
                { "Name": "CRP", "Count": 538, "EOS": 379 },
                { "Name": "FAST", "Count": 705, "EOS": 329 },
                { "Name": "OFM", "Count": 264, "EOS": 249 },
                { "Name": "MJT", "Count": 353, "EOS": 215 }
            ],
            "active": 6871,
            "eos": 10080,
            "antivirus": [
                { "Name": "Sentinel", "Count": 11521 },
                { "Name": "ESET", "Count": 3827 },
                { "Name": "CrowdStrike", "Count": 878 },
                { "Name": "Defender", "Count": 387 },
                { "Name": "No AV", "Count": 160 },
                { "Name": "NULL", "Count": 178 }
            ],
            "patch": [
                { "Name": "Healthy", "Count": 3760 },
                { "Name": "End of Support", "Count": 10080 },
                { "Name": "Pending", "Count": 3107 },
                { "Name": "Not Support", "Count": 4 }
            ],
            "osDetailed": [
                { "Name": "Win 11 Pro (25H2)", "Count": 2917 },
                { "Name": "Win 11 Pro (23H2)", "Count": 2864 },
                { "Name": "Win 10 Pro (22H2)", "Count": 2360 },
                { "Name": "Win 10 Ent LTSC (1809)", "Count": 2239 },
                { "Name": "Win 11 Pro (24H2)", "Count": 1589 },
                { "Name": "Win 11 Pro (21H2)", "Count": 1460 },
                { "Name": "Win 11 Pro (22H2)", "Count": 951 },
                { "Name": "Win Embedded 7", "Count": 597 },
                { "Name": "Win 7 Pro", "Count": 363 },
                { "Name": "Win 7 Pro x64", "Count": 361 }
            ],
            "rebootAnalysis": { "Under7Days": 10044, "Under30Days": 4538, "Over30Days": 2367, "Unknown": 2 },
            "inventoryStatus": [
                { "Name": "No", "Count": 16120 },
                { "Name": "Yes", "Count": 830 },
                { "Name": "Allowed", "Count": 1 }
            ]
        };

        const { useState, useEffect, useRef } = React;

        function App() {
            const data = EMBEDDED_DATA;
            const charts = useRef({});

            useEffect(() => {
                // Cleanup previous charts
                Object.values(charts.current).forEach(chart => chart.destroy());

                // 1. Asset Type Distribution
                const typeCtx = document.getElementById('typeChart').getContext('2d');
                charts.current.type = new Chart(typeCtx, {
                    type: 'doughnut',
                    data: {
                        labels: data.typeDistribution.map(t => t.Name.charAt(0).toUpperCase() + t.Name.slice(1)),
                        datasets: [{
                            data: data.typeDistribution.map(t => t.Count),
                            backgroundColor: ['#0984e3', '#00cec9', '#b2bec3', '#6c5ce7', '#fab1a0'],
                            borderWidth: 0
                        }]
                    },
                    options: { maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
                });

                // 2. OS Support Overview
                const osCtx = document.getElementById('osChart').getContext('2d');
                charts.current.os = new Chart(osCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Active Support', 'End of Support'],
                        datasets: [{
                            data: [data.active, data.eos],
                            backgroundColor: ['#00b894', '#d63031'],
                            borderWidth: 0
                        }]
                    },
                    options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
                });

                // 3. Detailed OS Version
                const detOsCtx = document.getElementById('detOsChart').getContext('2d');
                charts.current.detOs = new Chart(detOsCtx, {
                    type: 'bar',
                    data: {
                        labels: data.osDetailed.map(os => os.Name),
                        datasets: [{
                            label: 'Asset Count',
                            data: data.osDetailed.map(os => os.Count),
                            backgroundColor: '#0984e3',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } }
                    }
                });

                // 4. Reboot Analysis
                const rebootCtx = document.getElementById('rebootChart').getContext('2d');
                charts.current.reboot = new Chart(rebootCtx, {
                    type: 'pie',
                    data: {
                        labels: ['< 7 Days', '7-30 Days', '> 30 Days', 'Unknown'],
                        datasets: [{
                            data: [
                                data.rebootAnalysis.Under7Days,
                                data.rebootAnalysis.Under30Days,
                                data.rebootAnalysis.Over30Days,
                                data.rebootAnalysis.Unknown
                            ],
                            backgroundColor: ['#55efc4', '#ffeaa7', '#fab1a0', '#dfe6e9'],
                            borderWidth: 0
                        }]
                    },
                    options: { maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
                });

                // 5. Antivirus Distribution
                const avCtx = document.getElementById('avChart').getContext('2d');
                charts.current.av = new Chart(avCtx, {
                    type: 'bar',
                    data: {
                        labels: data.antivirus.map(av => av.Name),
                        datasets: [{
                            label: 'Count',
                            data: data.antivirus.map(av => av.Count),
                            backgroundColor: '#6c5ce7',
                            borderRadius: 4
                        }]
                    },
                    options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
                });

                // 6. BU Risk
                const buCtx = document.getElementById('buChart').getContext('2d');
                charts.current.bu = new Chart(buCtx, {
                    type: 'bar',
                    data: {
                        labels: data.buRisk.map(bu => bu.Name),
                        datasets: [{
                            label: 'EOS Machines',
                            data: data.buRisk.map(bu => bu.EOS),
                            backgroundColor: '#c41e3a',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } }
                    }
                });

            }, [data]);

            return (
                <div>
                    <header className="header">
                        <div>
                            <h1>EIA System Audit Dashboard</h1>
                            <div className="date">ข้อมูลล่าสุด ณ วันที่ 28 กุมภาพันธ์ 2569 | Central Group IT</div>
                        </div>
                        <div style={{textAlign:'right'}}>
                            <div style={{fontWeight:600}}>Executive Summary</div>
                            <div style={{fontSize:'0.8rem'}}>Asset Health & Compliance</div>
                        </div>
                    </header>

                    <div className="container">
                        <div className="kpi-row">
                            <div className="kpi-card info">
                                <h3>Total Assets</h3>
                                <div className="value">{data.total.toLocaleString()}</div>
                                <div style={{color:'var(--text-secondary)', fontSize:'0.85rem'}}>Managed Devices</div>
                            </div>
                            <div className="kpi-card danger">
                                <h3>Critical Risk (EOS)</h3>
                                <div className="value">{data.eos.toLocaleString()}</div>
                                <div style={{color:'var(--danger)', fontSize:'0.85rem'}}>{((data.eos/data.total)*100).toFixed(1)}% Vulnerable Assets</div>
                            </div>
                            <div className="kpi-card info">
                                <h3>BitLocker Off</h3>
                                <div className="value">{data.bitlocker.off.toLocaleString()}</div>
                                <div style={{color:'var(--text-secondary)', fontSize:'0.85rem'}}>Encryption Missing</div>
                            </div>
                            <div className="kpi-card warning">
                                <h3>High Restart Delay</h3>
                                <div className="value">{data.rebootAnalysis.Over30Days.toLocaleString()}</div>
                                <div style={{color:'var(--warning)', fontSize:'0.85rem'}}>Pending Updates (>30d)</div>
                            </div>
                            <div className="kpi-card success">
                                <h3>Healthy Patches</h3>
                                <div className="value">{data.patch[0].Count.toLocaleString()}</div>
                                <div style={{color:'var(--success)', fontSize:'0.85rem'}}>Full Compliance Level</div>
                            </div>
                        </div>

                        <div className="section-title">Device & OS Inventory Statistics</div>
                        <div className="chart-grid">
                            <div className="chart-card">
                                <h2>Asset Type Distribution</h2>
                                <div className="chart-container">
                                    <canvas id="typeChart"></canvas>
                                </div>
                            </div>
                            <div className="chart-card">
                                <h2>OS Support Status</h2>
                                <div className="chart-container">
                                    <canvas id="osChart"></canvas>
                                </div>
                            </div>
                            <div className="chart-card">
                                <h2>Detailed OS Version Breakdown</h2>
                                <div className="chart-container">
                                    <canvas id="detOsChart"></canvas>
                                </div>
                            </div>
                            <div className="chart-card">
                                <h2>Days Since Last Reboot</h2>
                                <div className="chart-container">
                                    <canvas id="rebootChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div className="section-title">Security Compliance & Business Risk</div>
                        <div className="chart-grid">
                            <div className="chart-card">
                                <h2>EOS Assets by Business Unit</h2>
                                <div className="chart-container">
                                    <canvas id="buChart"></canvas>
                                </div>
                            </div>
                            <div className="chart-card">
                                <h2>Antivirus Coverage Overview</h2>
                                <div className="chart-container">
                                    <canvas id="avChart"></canvas>
                                </div>
                            </div>

                            <div className="chart-card full-width">
                                <h2>Risk Ranking by Business Unit (All BUs)</h2>
                                <div className="table-container">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Business Unit</th>
                                                <th>Total Assets</th>
                                                <th>EOS Machines</th>
                                                <th>Risk Ratio</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {data.buRisk.sort((a, b) => (b.EOS/b.Count) - (a.EOS/a.Count)).map((bu, idx) => {
                                                const risk = (bu.EOS / bu.Count) * 100;
                                                return (
                                                    <tr key={idx}>
                                                        <td style={{fontWeight:600}}>{bu.Name}</td>
                                                        <td>{bu.Count.toLocaleString()}</td>
                                                        <td style={{color:'var(--danger)', fontWeight:500}}>{bu.EOS.toLocaleString()}</td>
                                                        <td>{risk.toFixed(1)}%</td>
                                                        <td>
                                                            {risk > 70 ? <span className="badge badge-danger">Critical</span> :
                                                            risk > 40 ? <span className="badge badge-warning">High Risk</span> :
                                                            <span className="badge badge-success">Acceptable</span>}
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
